{"version":3,"file":"static/js/323.d2e284ee.chunk.js","mappings":"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","sources":["hooks/useSavedMovies/queries.js","hooks/useSavedMovies/index.js","pages/Recommendation/queries.js","pages/Recommendation/index.js","utils/renderSkeletons.js"],"sourcesContent":["import { gql } from \"@apollo/client\";\n\nexport const GET_SAVED_MOVIES = gql`\n  query GetSavedMovies($page: Int, $all: Boolean) {\n    getSavedMovies(page: $page, all: $all) {\n      page\n      totalResults\n      totalPages\n      results {\n        id\n        movieId\n        title\n        image\n        releaseDate(format: \"dd.MM.yyyy\")\n        voteAverage\n        voteCount\n      }\n    }\n  }\n`;\n\nexport const SAVE_MOVIE = gql`\n  mutation SaveMovie($movie: MovieInput!) {\n    saveMovie(movie: $movie) {\n      id\n      movieId\n      title\n      releaseDate(format: \"dd.MM.yyyy\")\n      image\n      voteAverage\n      voteCount\n    }\n  }\n`;\n\nexport const REMOVE_MOVIE = gql`\n  mutation RemoveMovie($id: ID!) {\n    removeMovie(id: $id) {\n      id\n      movieId\n      title\n      releaseDate(format: \"dd.MM.yyyy\")\n      image\n    }\n  }\n`;\n","import { useContext, useLayoutEffect, useState } from \"react\"; // React hooks\nimport { AppContext } from \"../../providers/appContext\"; // Context provider\nimport { useMutation, useQuery } from \"@apollo/client\"; // Apollo Client hooks\nimport { GET_SAVED_MOVIES, SAVE_MOVIE, REMOVE_MOVIE } from \"./queries\"; // GraphQL queries\n\nexport const useSavedMovies = () => {\n  const { state } = useContext(AppContext);\n  const [savedMoviesLoading, setSavedMoviesLoading] = useState(false);\n  const [saveMovie] = useMutation(SAVE_MOVIE);\n  const { loading, error, data, refetch } = useQuery(GET_SAVED_MOVIES, {\n    variables: { page: 1, all: true },\n    // skip: true, // Изначально пропускаем запрос\n    // onError: async error => {\n    //   console.log(`Error loading`, error);\n    // },\n  });\n  const [removeMovie] = useMutation(REMOVE_MOVIE);\n  const [savedMovies, setSavedMovies] = useState([]);\n\n  useLayoutEffect(() => {\n    if (state.user) {\n      // Если пользователь существует, запускаем refetch для получения данных\n      refetch();\n    }\n  }, [state.user, refetch]);\n\n  useLayoutEffect(() => {\n    if (data && data?.getSavedMovies) {\n      setSavedMovies(data.getSavedMovies.results); // Устанавливаем фильмы, когда есть данные\n    }\n  }, [data]);\n\n  const addMovieToSaved = async movie => {\n    // console.log(`movie!!!!`, movie);\n    setSavedMoviesLoading(true);\n    const isNewMovie = !savedMovies.find(({ id }) => id === movie.id);\n\n    if (isNewMovie) {\n      setSavedMovies(prevMovies => {\n        const updatedMovies = [...prevMovies, { ...movie, movieId: movie.id }];\n        return updatedMovies;\n      });\n\n      try {\n        const movieObj = {\n          id: movie.id,\n          title: movie.title,\n          releaseDate: movie.releaseDate,\n          image: movie.image || \"\",\n          genres: movie?.genres?.map(m => m.id) || [],\n          adult: movie.adult || false,\n          backdropPath: movie.backdropPath || \"\",\n          originalLanguage: movie.originalLanguage || \"\",\n          originalTitle: movie.originalTitle || \"\",\n          overview: movie.overview || \"\",\n          popularity: movie.popularity || 0,\n          video: movie.video || false,\n          voteAverage: movie.voteAverage || 0,\n          voteCount: movie.voteCount || 0,\n        };\n\n        await saveMovie({\n          variables: {\n            movie: movieObj,\n          },\n        });\n\n        return true;\n      } catch (error) {\n        console.error(\"Error saving movie:\", error);\n        return false;\n      } finally {\n        setSavedMoviesLoading(false);\n      }\n    }\n  };\n\n  const removeMovieFromSaved = async movie => {\n    // console.log(`movie---`, movie);\n    setSavedMoviesLoading(true);\n    try {\n      await removeMovie({\n        variables: {\n          id: movie.id,\n        },\n      });\n      setSavedMovies(prevMovies => {\n        const updatedMovies = prevMovies.filter(m => {\n          const movieIdCheck = m.movieId\n            ? String(m.movieId) !== String(movie.id)\n            : true;\n          return String(m.id) !== String(movie.id) && movieIdCheck;\n        });\n\n        return updatedMovies;\n      });\n      return true;\n    } catch (error) {\n      console.error(\"Error removing movie:\", error);\n      return false;\n    } finally {\n      setSavedMoviesLoading(false);\n    }\n  };\n\n  return {\n    savedMovies,\n    addMovieToSaved,\n    removeMovieFromSaved,\n    savedMoviesLoading,\n    loading,\n    error,\n  };\n};\n","import { gql } from \"@apollo/client\";\n\nconst MOVIES_BY_IDS_QUERY = gql`\n  query MoviesByIds($ids: [Int]) {\n    moviesByIds(ids: $ids) {\n      releaseDate(format: \"dd MMM yyy\")\n      image: posterPath\n      title\n      id\n      adult\n      backdropPath\n      originalLanguage\n      originalTitle\n      overview\n      popularity\n      video\n      voteAverage\n      voteCount\n    }\n  }\n`;\n\nexport { MOVIES_BY_IDS_QUERY };\n","import { useContext, useEffect, useState } from \"react\";\nimport { useSearchParams } from \"react-router-dom\";\nimport { useQuery } from \"@apollo/client\";\nimport { Box, Grid, Paper, Typography } from \"@mui/material\";\n\nimport { MOVIES_BY_IDS_QUERY } from \"./queries\";\nimport { MovieDetailModal, MovieCard, ServerError } from \"../../components\";\nimport renderSkeletons from \"../../utils/renderSkeletons\";\nimport { AppContext } from \"../../providers/appContext\";\nimport { FormattedMessage } from \"react-intl\";\nimport { useSavedMovies } from \"../../hooks/useSavedMovies\";\nimport { useCustomNotification } from \"../../hooks/useCustomNotification\";\n\nconst Recommendation = () => {\n  const {\n    savedMovies,\n    addMovieToSaved,\n    removeMovieFromSaved,\n    savedMoviesLoading,\n  } = useSavedMovies();\n  const { state } = useContext(AppContext);\n  const [searchParams] = useSearchParams();\n  const [movieCardIsLoading, setMovieCardIsLoading] = useState(false);\n  const [movieId, setMovieId] = useState(\"\");\n  const [params, setParams] = useState({ title: \"\", ids: [] });\n  const [boxMinHeight, setBoxMinHeight] = useState(\"100vh\");\n  const { showNotification, NotificationComponent } = useCustomNotification();\n\n  const { loading, error, data } = useQuery(MOVIES_BY_IDS_QUERY, {\n    variables: { ids: params.ids },\n  });\n\n  useEffect(() => {\n    const ids = searchParams\n      .get(\"ids\")\n      .split(\",\")\n      .map(id => +id);\n    const title = searchParams.get(\"title\");\n\n    setParams({ title, ids });\n  }, [searchParams]);\n\n  useEffect(() => {\n    // Dynamically find the header and calculate its height\n    const headerElement = document.querySelector(\"header\");\n    const footerElement = document.querySelector(\"footer\");\n\n    if (headerElement) {\n      const headerHeight = headerElement.offsetHeight;\n      const footerHeight = footerElement.offsetHeight;\n      setBoxMinHeight(`calc(100vh - ${headerHeight + footerHeight}px)`);\n    }\n  }, []);\n\n  const onCloseConfirmModal = () => {\n    setMovieId(\"\");\n  };\n\n  const addFavoriteMovie = async movie => {\n    const result = await addMovieToSaved(movie);\n\n    if (!result) {\n      showNotification(\"Error in saving movie\", \"error\", 5000, {\n        vertical: \"bottom\",\n        horizontal: \"right\",\n      });\n    } else {\n      showNotification(\n        <FormattedMessage id=\"notification.movie_add_to_favorite_successfully\" />,\n        \"success\",\n        1000,\n        {\n          vertical: \"bottom\",\n          horizontal: \"right\",\n        }\n      );\n    }\n  };\n\n  const removeFavoriteMovie = async movie => {\n    const result = await removeMovieFromSaved(movie);\n    if (!result) {\n      showNotification(\"Error in removing movie\", \"error\", 5000, {\n        vertical: \"bottom\",\n        horizontal: \"right\",\n      });\n    } else {\n      showNotification(\n        <FormattedMessage id=\"notification.movie_removed_successfully\" />,\n        \"success\",\n        1000,\n        {\n          vertical: \"bottom\",\n          horizontal: \"right\",\n        }\n      );\n    }\n  };\n\n  if (error) {\n    console.log(`error in recommendation page: ${error}`);\n    return <ServerError />;\n  }\n\n  return (\n    <Box\n      sx={{\n        minHeight: boxMinHeight,\n        display: \"flex\",\n        flexDirection: \"column\",\n        alignItems: \"center\",\n        padding: 3,\n        backgroundColor: \"#f5f5f5\",\n      }}\n    >\n      <MovieDetailModal\n        user={state.user || null}\n        isPreviewMode\n        title={movieId}\n        movieId={movieId}\n        setMovieCardIsLoading={setMovieCardIsLoading}\n        open={!!movieId}\n        onClose={onCloseConfirmModal}\n        addFavoriteMovie={addFavoriteMovie}\n        removeFavoriteMovie={removeFavoriteMovie}\n        savedMovies={savedMovies}\n        savedMoviesLoading={savedMoviesLoading}\n      />\n      <Typography variant=\"h4\" gutterBottom>\n        {params.title ? params.title : \"Recommended Movies\"}\n      </Typography>\n      <Grid item xs={12} md={8} sx={{ width: \"100%\" }}>\n        <Paper sx={{ padding: 2, minHeight: \"400px\" }}>\n          <Box sx={{ flexGrow: 1 }}>\n            {loading && renderSkeletons({ favoriteMode: true })}\n            {data && (\n              <Grid container spacing={2}>\n                {data.moviesByIds.map(movie => (\n                  <Grid key={movie.id} item xs={12} md={3} lg={2}>\n                    <MovieCard\n                      movie={movie}\n                      movieCardIsLoading={movieCardIsLoading}\n                      onCardSelect={() => console.log(`onCardSelect`)}\n                      openMovieDetailsById={setMovieId}\n                      isPreviewMode\n                    />\n                  </Grid>\n                ))}\n              </Grid>\n            )}\n          </Box>\n        </Paper>\n      </Grid>\n      {NotificationComponent}\n    </Box>\n  );\n};\n\nexport default Recommendation;\n","import { Grid, Skeleton } from \"@mui/material\";\n\nconst renderSkeletons = ({ favoriteMode = false }) => {\n  return (\n    <Grid container spacing={2}>\n      {Array.from(new Array(8)).map((_, index) => (\n        <Grid\n          key={index}\n          item\n          xs={12}\n          md={favoriteMode ? 3 : 4}\n          lg={favoriteMode ? 2 : 3}\n        >\n          <Skeleton variant=\"rectangular\" height={431} />\n          <Skeleton variant=\"text\" height={32} />\n          <Skeleton variant=\"text\" height={32} />\n        </Grid>\n      ))}\n    </Grid>\n  );\n};\n\nexport default renderSkeletons;\n"],"names":["GET_SAVED_MOVIES","gql","SAVE_MOVIE","REMOVE_MOVIE","useSavedMovies","state","useContext","AppContext","savedMoviesLoading","setSavedMoviesLoading","useState","saveMovie","useMutation","loading","error","data","refetch","useQuery","variables","page","all","removeMovie","savedMovies","setSavedMovies","useLayoutEffect","user","getSavedMovies","results","addMovieToSaved","async","find","_ref","id","movie","prevMovies","movieId","_movie$genres","movieObj","title","releaseDate","image","genres","map","m","adult","backdropPath","originalLanguage","originalTitle","overview","popularity","video","voteAverage","voteCount","console","removeMovieFromSaved","filter","movieIdCheck","String","MOVIES_BY_IDS_QUERY","Recommendation","searchParams","useSearchParams","movieCardIsLoading","setMovieCardIsLoading","setMovieId","params","setParams","ids","boxMinHeight","setBoxMinHeight","showNotification","NotificationComponent","useCustomNotification","useEffect","get","split","headerElement","document","querySelector","footerElement","headerHeight","offsetHeight","footerHeight","log","_jsx","ServerError","_jsxs","Box","sx","minHeight","display","flexDirection","alignItems","padding","backgroundColor","children","MovieDetailModal","isPreviewMode","open","onClose","onCloseConfirmModal","addFavoriteMovie","FormattedMessage","vertical","horizontal","removeFavoriteMovie","Typography","variant","gutterBottom","Grid","item","xs","md","width","Paper","flexGrow","renderSkeletons","favoriteMode","container","spacing","moviesByIds","lg","MovieCard","onCardSelect","openMovieDetailsById","Array","from","_","index","Skeleton","height"],"sourceRoot":""}